<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Master: Working Retro TV</title>
    
    <link rel="preconnect" href="https://dlhd.link" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
    
    <style>
        :root {
            --bg-body: #111;
            --tv-case: #2b2b2b;
            --tv-panel: #1a1a1a;
            --led-red: #ff3333;
            --led-green: #33ff33;
            --accent-gold: #d4af37;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle, #222 0%, #000 100%);
            height: 100vh; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Courier New', monospace;
        }

        /* --- THE TV UNIT --- */
        .tv-unit {
            position: relative;
            width: 900px; max-width: 95vw;
            background: var(--tv-case);
            border-radius: 30px;
            padding: 20px;
            box-shadow: 
                inset 0 0 40px #000,
                0 0 0 10px #1a1a1a,
                0 20px 50px rgba(0,0,0,0.8);
            display: flex;
            gap: 20px;
            border: 2px solid #333;
            /* Plastic Texture */
            background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3h1v1H1V3zm2-2h1v1H3V1z' fill='%23000000' fill-opacity='0.2'/%3E%3C/svg%3E");
        }

        /* --- SCREEN AREA --- */
        .screen-container {
            flex: 3;
            position: relative;
            background: #000;
            border-radius: 60% 60% 60% 60% / 10% 10% 10% 10%; /* Curved CRT look */
            border: 15px solid #111;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        .screen-glass {
            width: 100%; height: 100%;
            position: relative;
            background: #000;
            z-index: 2;
        }

        /* Scanlines & Glare */
        .screen-glass::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
            z-index: 10;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }
        
        .screen-glass::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 80%);
            z-index: 11;
            pointer-events: none;
        }

        /* Video Players */
        video, iframe { width: 100%; height: 100%; object-fit: fill; display: block; }
        #foxContainer, #daddyContainer { display: none; width: 100%; height: 100%; }

        /* Power Off Effect */
        .screen-off-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: #000; z-index: 20;
            display: none;
        }
        .tv-off .screen-off-overlay { display: block; animation: turn-off 0.4s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        
        @keyframes turn-off {
            0% { transform: scale(1, 1.3) translate3d(0, 0, 0); filter: brightness(1); opacity: 1; }
            60% { transform: scale(1, 0.001) translate3d(0, 0, 0); filter: brightness(10); }
            100% { transform: scale(0, 0.001) translate3d(0, 0, 0); filter: brightness(50); opacity: 0; }
        }

        /* --- CONTROL PANEL (Right Side) --- */
        .control-panel {
            flex: 1;
            background: var(--tv-panel);
            border-radius: 10px;
            border: 2px solid #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 10px;
            gap: 25px;
            box-shadow: inset 0 0 20px #000;
            max-width: 180px;
        }

        /* Channel Display (Digital) */
        .digital-display {
            background: #222;
            color: var(--led-green);
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            padding: 5px 10px;
            border: 2px inset #444;
            border-radius: 4px;
            text-shadow: 0 0 5px var(--led-green);
            width: 100%; text-align: center;
            margin-bottom: 10px;
        }

        /* Knobs */
        .knob-group {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            width: 100%;
        }
        .knob-label { color: #888; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
        
        .knob-surround {
            width: 90px; height: 90px;
            position: relative;
            display: flex; align-items: center; justify-content: center;
        }
        .knob {
            width: 70px; height: 70px;
            background: radial-gradient(circle, #333 0%, #111 100%);
            border-radius: 50%;
            border: 4px solid #000;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.1);
            position: relative;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: grab;
        }
        .knob::after { /* The Indicator Line */
            content: ''; position: absolute; top: 5px; left: 50%;
            width: 4px; height: 15px; background: #fff;
            transform: translateX(-50%);
            box-shadow: 0 0 5px #fff;
        }
        
        .knob-btn {
            position: absolute; width: 30px; height: 30px;
            background: transparent; border: none; cursor: pointer;
            color: #555; font-size: 1.2rem;
        }
        .knob-btn:hover { color: #fff; }
        .k-left { left: 0; } .k-right { right: 0; }

        /* Power Button */
        .power-group { margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .power-btn {
            width: 40px; height: 40px;
            background: radial-gradient(circle, #ff5555 0%, #990000 100%);
            border: 3px solid #550000;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(255,0,0,0.5);
            cursor: pointer;
            position: relative;
        }
        .power-btn:active { transform: scale(0.95); box-shadow: inset 0 0 10px #000; }
        .led-light {
            width: 8px; height: 8px; background: #300; border-radius: 50%; margin-top: 5px;
            transition: 0.3s;
        }
        .tv-on .led-light { background: #f00; box-shadow: 0 0 10px #f00; }

        /* Playback Buttons */
        .playback-controls {
            display: flex; gap: 10px; width: 100%; justify-content: center;
        }
        .rect-btn {
            width: 40px; height: 25px;
            background: #333; border: 1px solid #000;
            border-radius: 2px; color: #aaa; font-size: 0.7rem;
            cursor: pointer; box-shadow: 0 3px 0 #000;
            display: flex; align-items: center; justify-content: center;
        }
        .rect-btn:active { transform: translateY(3px); box-shadow: none; }

        /* Speaker Grille */
        .speaker-grille {
            width: 100%; height: 60px;
            background-image: linear-gradient(90deg, #111 50%, #222 50%);
            background-size: 6px 100%;
            border-radius: 4px;
            box-shadow: inset 0 0 10px #000;
            margin-top: 15px;
        }

        /* Overlay UI */
        .ui-overlay {
            position: absolute; top: 20px; left: 20px; color: #0f0;
            font-family: monospace; font-size: 1.2rem;
            text-shadow: 0 0 5px #0f0; display: none; z-index: 15;
        }

        /* Menu Button */
        .menu-btn-float {
            position: fixed; top: 20px; left: 20px;
            background: rgba(0,0,0,0.7); color: #fff;
            border: 1px solid #fff; padding: 10px 20px;
            border-radius: 30px; cursor: pointer; z-index: 100;
        }

        /* Responsive */
        @media (max-width: 800px) {
            .tv-unit { flex-direction: column; width: 95%; padding: 10px; }
            .control-panel { 
                flex-direction: row; width: 100%; max-width: none; 
                height: auto; padding: 10px; justify-content: space-around;
            }
            .knob-group { width: auto; }
            .knob-surround { width: 60px; height: 60px; }
            .knob { width: 50px; height: 50px; }
            .speaker-grille { display: none; }
        }
    </style>
</head>
<body class="tv-on"> <button class="menu-btn-float" onclick="window.location.reload()">
        <i class="fa-solid fa-list"></i> Channels
    </button>

    <div class="tv-unit">
        <div class="screen-container">
            <div class="screen-glass">
                <video id="videoPlayer" playsinline></video>
                <div id="foxContainer"></div>
                <div id="daddyContainer"></div>
                
                <div id="osd" class="ui-overlay">VOLUME: 100%</div>
                
                <div class="screen-off-overlay"></div>
            </div>
        </div>

        <div class="control-panel">
            
            <div class="digital-display" id="channelDisplay">CH-01</div>

            <div class="knob-group">
                <div class="knob-label">VOLUME</div>
                <div class="knob-surround">
                    <button class="knob-btn k-left" onclick="adjustVolume(-0.1)"><i class="fa-solid fa-minus"></i></button>
                    <div class="knob" id="volKnob"></div>
                    <button class="knob-btn k-right" onclick="adjustVolume(0.1)"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <div class="knob-group">
                <div class="knob-label">QUALITY</div>
                <div class="knob-surround">
                    <button class="knob-btn k-left" onclick="cycleQuality(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                    <div class="knob" id="qualKnob" style="transform: rotate(45deg);"></div>
                    <button class="knob-btn k-right" onclick="cycleQuality(1)"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
            </div>

            <div class="playback-controls">
                <button class="rect-btn" onclick="togglePlay()"><i class="fa-solid fa-play"></i>/ <i class="fa-solid fa-pause"></i></button>
                <button class="rect-btn" onclick="toggleMute()"><i class="fa-solid fa-volume-xmark"></i></button>
            </div>

            <div class="speaker-grille"></div>

            <div class="power-group">
                <button class="power-btn" onclick="togglePower()"></button>
                <div class="led-light"></div>
                <div class="knob-label" style="margin-top:5px;">POWER</div>
            </div>

        </div>
    </div>

    <script>
        /* --- LOGIC ENGINE --- */
        const video = document.getElementById('videoPlayer');
        const volKnob = document.getElementById('volKnob');
        const qualKnob = document.getElementById('qualKnob');
        const osd = document.getElementById('osd');
        const channelDisplay = document.getElementById('channelDisplay');
        const daddyContainer = document.getElementById('daddyContainer');
        const foxContainer = document.getElementById('foxContainer');
        
        let isTvOn = true;
        let volLevel = 1;
        let volRotation = 0;
        let qualRotation = 45;
        let hls;
        
        // --- 1. POWER CONTROL ---
        function togglePower() {
            const body = document.body;
            isTvOn = !isTvOn;
            
            if (isTvOn) {
                body.classList.add('tv-on');
                body.classList.remove('tv-off');
                if(video.src || hls) video.play();
                showOSD("POWER ON");
            } else {
                body.classList.remove('tv-on');
                body.classList.add('tv-off');
                video.pause();
                // Hide iframes
                daddyContainer.style.display = 'none';
                foxContainer.style.display = 'none';
            }
        }

        // --- 2. VOLUME CONTROL (Knob Logic) ---
        function adjustVolume(change) {
            if (!isTvOn) return;
            
            volLevel += change;
            if (volLevel > 1) volLevel = 1;
            if (volLevel < 0) volLevel = 0;
            
            video.volume = volLevel;
            
            // Rotate Knob visually
            volRotation += (change * 100); 
            volKnob.style.transform = `rotate(${volRotation}deg)`;
            
            showOSD(`VOLUME: ${Math.round(volLevel * 100)}%`);
        }

        function toggleMute() {
            video.muted = !video.muted;
            showOSD(video.muted ? "MUTED" : "UNMUTED");
        }

        // --- 3. QUALITY CONTROL (HLS Levels) ---
        function cycleQuality(direction) {
            if (!isTvOn || !hls) {
                showOSD("NO SIGNAL");
                return;
            }

            // Visual Rotation
            qualRotation += (direction * 45);
            qualKnob.style.transform = `rotate(${qualRotation}deg)`;

            const levels = hls.levels;
            let current = hls.currentLevel; // -1 is auto
            
            if (current === -1 && direction > 0) current = 0;
            else if (current === -1 && direction < 0) current = levels.length - 1;
            else current += direction;

            if (current >= levels.length) current = -1; // Loop back to Auto
            if (current < -1) current = levels.length - 1;

            hls.currentLevel = current;
            
            let label = (current === -1) ? "AUTO" : `${levels[current].height}p`;
            showOSD(`QUALITY: ${label}`);
            channelDisplay.innerText = label;
        }

        // --- 4. PLAYBACK CONTROL ---
        function togglePlay() {
            if (!isTvOn) return;
            if (video.paused) {
                video.play();
                showOSD("PLAY");
            } else {
                video.pause();
                showOSD("PAUSE");
            }
        }

        // --- UTILS ---
        let osdTimer;
        function showOSD(text) {
            osd.innerText = text;
            osd.style.display = 'block';
            clearTimeout(osdTimer);
            osdTimer = setTimeout(() => {
                osd.style.display = 'none';
            }, 2000);
        }

        // --- INIT DUMMY STREAM (To show it working) ---
        // You would normally call loadStream(url) from your list page
        window.onload = function() {
            // Load a default test channel to demonstrate controls
            loadHLS("https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"); 
            channelDisplay.innerText = "CH-01";
        };

        function loadHLS(url) {
            if (Hls.isSupported()) {
                if (hls) hls.destroy();
                hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
                video.play();
            }
        }
    </script>
</body>
</html>
