<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player: Master Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
    <style>
        :root {
            --bg-body: #0b0b10;
            --bg-card: #16161e;
            --bg-header: #13131a;
            --accent-yellow: #fce83a;
            --accent-cyan: #00e5ff;
            --accent-red: #ff4757;
            --accent-purple: #a55eea;
            --text-main: #ffffff;
            --text-muted: #7a7a8c;
            --border-color: #252530;
            --tv-bezel: #202025;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- LOAD SCREEN --- */
        #loadScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .load-box {
            background: var(--bg-card); padding: 30px; border-radius: 12px;
            text-align: center; border: 1px solid var(--border-color); 
            width: 700px; max-width: 95%; max-height: 90vh; overflow-y: auto;
        }
        
        .section-divider {
            width: 100%; height: 1px; background: #333; margin: 25px 0; position: relative;
        }
        .section-divider span {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            background: var(--bg-card); padding: 0 10px; color: #666; font-size: 0.8rem;
        }

        .input-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .url-input {
            flex: 1; background: #000; border: 1px solid #333;
            color: #fff; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 0.95rem;
        }
        .btn-remove {
            background: #ff4757; color: #fff; border: none; width: 40px; height: 40px;
            border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .btn-add {
            background: #252530; color: #fff; border: 1px dashed #666; width: 100%; padding: 12px;
            border-radius: 6px; cursor: pointer; margin-bottom: 20px; font-size: 0.9rem;
        }
        
        /* Main Buttons */
        .btn-start {
            background: var(--accent-yellow); color: #000; padding: 14px 40px;
            border: none; font-weight: bold; border-radius: 30px; cursor: pointer;
            font-size: 1.1rem; width: 100%; margin-bottom: 10px; transition: transform 0.2s;
        }
        .btn-fox {
            background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; padding: 14px 40px;
            border: none; font-weight: bold; border-radius: 30px; cursor: pointer;
            font-size: 1.1rem; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 10px; transition: transform 0.2s;
        }
        .btn-daddy {
            background: linear-gradient(135deg, #a55eea, #8854d0); color: #fff; padding: 14px 40px;
            border: none; font-weight: bold; border-radius: 30px; cursor: pointer;
            font-size: 1.1rem; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.2s;
        }
        .btn-start:active, .btn-fox:active, .btn-daddy:active { transform: scale(0.98); }

        /* --- LIST VIEW --- */
        #listView {
            padding: 20px; height: 100%; max-width: 1000px; margin: 0 auto;
            width: 100%; display: none; flex-direction: column;
        }
        .search-input {
            width: 100%; background: var(--bg-card); border: 1px solid var(--border-color);
            padding: 15px 20px; border-radius: 8px; color: #fff; font-size: 1.1rem; outline: none; margin-bottom: 20px;
        }
        .list-content { flex: 1; overflow-y: auto; padding-right: 10px; }
        .list-content::-webkit-scrollbar { width: 8px; }
        .list-content::-webkit-scrollbar-track { background: var(--bg-body); }
        .list-content::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

        .channel-row {
            display: flex; align-items: center; background-color: var(--bg-card);
            border: 1px solid var(--border-color); margin-bottom: 12px; padding: 15px 20px; border-radius: 8px;
            transform: translateZ(0);
        }
        .row-actions { display: flex; align-items: center; gap: 15px; margin-right: 30px; min-width: 140px; }
        .btn-watch { background-color: var(--accent-yellow); color: #000; border: none; padding: 8px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; }
        
        .btn-watch.dl-btn { background-color: var(--accent-purple); color: #fff; }

        .row-logo { width: 50px; height: 50px; background: #000; border-radius: 6px; margin-right: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .row-logo img { width: 100%; height: 100%; object-fit: cover; }
        .row-info { flex: 1; }
        .row-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 6px; color: #fff; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.75rem; margin-right: 8px; text-transform: uppercase; }
        .badge-source { background: rgba(0, 229, 255, 0.1); color: var(--accent-cyan); border: 1px solid rgba(0, 229, 255, 0.3); }
        .badge-dl { background: rgba(165, 94, 234, 0.1); color: var(--accent-purple); border: 1px solid rgba(165, 94, 234, 0.3); }
        .badge-group { background: #252530; color: #aaa; }
        .results-info { color: #555; font-size: 0.8rem; padding: 10px; text-align: center; }

        /* --- PLAYER VIEW --- */
        #playerView { display: none; height: 100vh; flex-direction: column; }
        .player-header {
            height: 60px; background: var(--bg-header); border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-shrink: 0;
        }
        .btn-header {
            background: transparent; border: 1px solid #333; color: #fff;
            padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 6px;
        }
        .player-body { flex: 1; display: flex; overflow: hidden; position: relative; background: #000; }

        /* --- RETRO TV FRAME --- */
        .video-wrapper {
            flex: 1; display: flex; align-items: center; justify-content: center;
            position: relative; perspective: 1000px;
        }
        .retro-tv-box {
            background-color: var(--tv-bezel);
            padding: 30px 35px 50px 35px;
            border-radius: 30px;
            box-shadow: inset 0 0 20px #000, 0 20px 50px #000, 0 5px 0 #151515;
            position: relative; transition: all 0.5s ease;
            max-width: 90%; width: fit-content;
        }
        .tv-screen {
            border-radius: 20px; overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0,0,0,1);
            border: 3px solid #000; position: relative;
            background: #000; width: 800px; max-width: 100%; aspect-ratio: 16/9;
        }
        .tv-screen::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px; pointer-events: none; opacity: 0.3; z-index: 5;
        }

        /* --- CONTROLS --- */
        .res-badge {
            position: absolute; top: 15px; left: 15px; z-index: 30;
            background: rgba(0,0,0,0.6); color: #00ff00; font-family: monospace;
            padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;
            border: 1px solid #00ff00; pointer-events: none;
            text-shadow: 0 0 5px #00ff00;
        }
        .player-controls {
            position: absolute; top: 15px; right: 15px; 
            z-index: 30; display: flex; gap: 10px;
        }
        .fs-btn {
            background: rgba(0,0,0,0.8); color: #fff; border: 1px solid #444;
            padding: 5px 10px; border-radius: 4px; cursor: pointer;
        }

        /* Video vs Iframe */
        video { width: 100%; height: 100%; outline: none; display: block; }
        
        #iframeContainer {
            width: 100%; height: 100%; display: none; background: #000;
        }
        #iframeContainer iframe {
            width: 100%; height: 100%; border: 0;
        }

        /* Fullscreen Mods */
        .player-body.is-fullscreen .retro-tv-box { padding: 0; border-radius: 0; box-shadow: none; width: 100%; height: 100%; max-width: none; background: none; }
        .player-body.is-fullscreen .tv-screen { border-radius: 0; border: none; box-shadow: none; width: 100%; height: 100%; aspect-ratio: auto; }
        .player-body.is-fullscreen .tv-decor-bottom, .player-body.is-fullscreen .tv-speaker, .player-body.is-fullscreen .tv-screen::after { display: none; }

        .tv-decor-bottom { position: absolute; bottom: 15px; right: 35px; display: flex; gap: 15px; }
        .tv-knob { width: 25px; height: 25px; background: #151515; border-radius: 50%; box-shadow: inset 0 1px 3px rgba(255,255,255,0.1), 0 2px 2px #000; }
        .tv-speaker { position: absolute; bottom: 15px; left: 35px; width: 100px; height: 25px; background-image: linear-gradient(to right, #000 50%, transparent 50%); background-size: 4px 100%; opacity: 0.5; }
    </style>
</head>
<body>

    <div id="loadScreen">
        <div class="load-box">
            <h2 style="color: var(--accent-yellow);">IPTV Master</h2>
            
            <div id="inputContainer">
                <div class="input-row">
                    <input type="text" class="url-input" placeholder="Paste Playlist URL..." value="https://tvpass.org/playlist/m3u">
                    <button class="btn-remove" onclick="removeRow(this)" style="opacity:0.5; pointer-events:none;"><i class="fa-solid fa-times"></i></button>
                </div>
            </div>
            <button class="btn-add" onclick="addInputRow()"><i class="fa-solid fa-plus"></i> Add Playlist</button>
            <button class="btn-start" onclick="loadAllPlaylists()">LOAD CHANNELS</button>
            
            <div class="section-divider"><span>SPECIAL LIBRARIES</span></div>

            <button class="btn-daddy" onclick="loadDaddyLive()">
                <i class="fa-solid fa-satellite-dish"></i> DADDYLIVE LIBRARY (350+ CHANNELS)
            </button>

            <button class="btn-fox" onclick="loadFoxTV()">
                <i class="fa-solid fa-tv"></i> WATCH FOX TV LIVE
            </button>
            <div id="statusLog" style="margin-top:15px; text-align:left; max-height:100px; overflow-y:auto; font-size:0.85rem; color:#888;"></div>
        </div>
    </div>

    <div id="listView">
        <input type="text" id="channelSearch" class="search-input" placeholder="Search channels..." oninput="handleSearch()">
        <div id="listContent" class="list-content"></div>
    </div>

    <div id="playerView">
        <div class="player-header">
            <div class="header-left">
                <button class="btn-header" style="border-color: var(--accent-yellow); color:var(--accent-yellow)" onclick="goBack()">
                    <i class="fa-solid fa-arrow-left"></i> Exit
                </button>
            </div>
            <div><button class="btn-header"><i class="fa-solid fa-comments"></i> Chat</button></div>
        </div>

        <div class="player-body" id="playerBody">
            <div class="video-wrapper">
                <div class="retro-tv-box">
                    <div class="tv-screen">
                        
                        <div id="resBadge" class="res-badge">Ready</div>
                        
                        <div class="player-controls">
                            <select id="qualitySelect" style="display:none; background:rgba(0,0,0,0.8); color:var(--accent-yellow); border:1px solid var(--accent-yellow); padding:5px; border-radius:4px;" onchange="changeQuality(this.value)">
                                <option value="-1">Auto</option>
                            </select>
                            <button class="fs-btn" onclick="toggleCustomFullscreen()"><i class="fa-solid fa-expand"></i></button>
                        </div>

                        <video id="videoPlayer" controls></video>
                        <div id="iframeContainer"></div>
                    
                    </div>
                    <div class="tv-speaker"></div>
                    <div class="tv-decor-bottom">
                        <div class="tv-knob" style="transform: rotate(15deg);"></div>
                        <div class="tv-knob" style="transform: rotate(-45deg);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allChannels = [];
        const video = document.getElementById('videoPlayer');
        const iframeContainer = document.getElementById('iframeContainer');
        const playerBody = document.getElementById('playerBody');
        const qualitySelect = document.getElementById('qualitySelect');
        const resBadge = document.getElementById('resBadge');
        let hls;

        // --- OPTIMIZATION VARIABLES ---
        let searchTimer; 
        const RENDER_LIMIT = 100; 

        // --- 1. DADDYLIVE DATA (Your Exact List) ---
        const dlChannelNames = [
            "ABC USA","A&E USA","AMC USA","Animal Planet","ACC Network USA","Astro SuperSport 1","Astro SuperSport 2","Astro SuperSport 3","Astro SuperSport 4",
            "Arena Sport 1 Premium","Arena Sport 2 Premium","Arena Sport 3 Premium","Arena Sport 1 Serbia","Arena Sport 2 Serbia","Arena Sport 3 Serbia","Arena Sport 4 Serbia",
            "Arena Sport 1 Croatia","Arena Sport 2 Croatia","Arena Sport 3 Croatia","Arena Sport 4 Croatia","Alkass One","Alkass Two","Alkass Three","Alkass Four",
            "ABS-CBN","Arena Sport 1 BiH","Abu Dhabi Sports 1 UAE","Abu Dhabi Sports 2 UAE","Abu Dhabi Sports 1 Premium","Abu Dhabi Sports 2 Premium","Astro Cricket",
            "Antena 3 Spain","Adult Swim","AXN Movies Portugal","Arte DE","AXS TV USA","ABCNY USA","beIN Sports MENA English 1","beIN Sports MENA English 2",
            "beIN Sports MENA English 3","beIN Sports MENA 1","beIN Sports MENA 2","beIN Sports MENA 3","beIN Sports MENA 4","beIN Sports MENA 5","beIN Sports MENA 6",
            "beIN Sports MENA 7","beIN Sports MENA Premium 1","beIN Sports MENA Premium 2","beIN Sports MENA Premium 3","beIN Sports MAX 4 France","beIN Sports MAX 5 France",
            "beIN Sports MAX 6 France","beIN Sports MAX 7 France","beIN Sports MAX 8 France","beIN Sports MAX 9 France","beIN Sports MAX 10 France","beIN SPORTS 1 France",
            "beIN SPORTS 2 France","beIN SPORTS 3 France","beIN SPORTS 1 Turkey","beIN SPORTS 2 Turkey","beIN SPORTS 3 Turkey","beIN SPORTS 4 Turkey","BeIN Sports HD Qatar",
            "BeIN SPORTS USA","beIN SPORTS en Español","beIN SPORTS Australia 1","beIN SPORTS Australia 2","beIN SPORTS Australia 3","Barca TV Spain","Benfica TV PT",
            "Boomerang","BNT 1 Bulgaria","BNT 2 Bulgaria","BNT 3 Bulgaria","BR Fernsehen DE","bTV Bulgaria","bTV Action Bulgaria","bTV Lady Bulgaria","BBC America (BBCA)",
            "BET USA","Bravo USA","BBC News Channel HD","BBC One UK","BBC Two UK","BBC Three UK","BBC Four UK","BIG TEN Network (BTN USA)","Cuatro Spain","Channel 4 UK",
            "Channel 5 UK","CBS Sports Network (CBSSN)","Canal+ France","Canal+ Sport France","Canal+ Foot France","Canal+ Sport360","Canal 11 Portugal","Canal+ Sport Poland",
            "Canal+ Sport 2 Poland","CANAL+ SPORT 5 Poland","Canal+ Premium Poland","Canal+ Family Poland","Canal+ Seriale Poland","Canal+ Sport 1 Afrique","Canal+ Sport 2 Afrique",
            "Canal+ Sport 3 Afrique","Canal+ Sport 4 Afrique","Canal+ Sport 5 Afrique","CANAL9 Denmark","Combate Brasil","C More Football Sweden","Cosmote Sport 1 HD",
            "Cosmote Sport 2 HD","Cosmote Sport 3 HD","Cosmote Sport 4 HD","Cosmote Sport 5 HD","Cosmote Sport 6 HD","Cosmote Sport 7 HD","Cosmote Sport 8 HD","Cosmote Sport 9 HD",
            "Channel 9 Israel","Channel 10 Israel","Channel 11 Israel","Channel 12 Israel","Channel 13 Israel","Channel 14 Israel","C More Stars Sweden","C More First Sweden",
            "C More Hits Sweden","C More Series Sweden","COZI TV USA","CMT USA","CBS USA","CW USA","CNBC USA","Comedy Central","Cartoon Network","CNN USA","Cinemax USA",
            "CTV Canada","CTV 2 Canada","Crime+ Investigation USA","Comet USA","Cooking Channel USA","Cleo TV","C SPAN 1","CBSNY USA","Citytv","CBC CA","DAZN 1 Bar DE",
            "DAZN 2 Bar DE","DAZN 1 Spain","DAZN 2 Spain","DAZN 3 Spain","DAZN 4 Spain","DAZN F1 ES","DAZN LaLiga","DAZN LaLiga 2","DR1 Denmark","DR2 Denmark",
            "Digi Sport 1 Romania","Digi Sport 2 Romania","Digi Sport 3 Romania","Digi Sport 4 Romania","Diema Sport Bulgaria","Diema Sport 2 Bulgaria","Diema Sport 3 Bulgaria",
            "Diema Bulgaria","Diema Family Bulgaria","Dubai Sports 1 UAE","Dubai Sports 2 UAE","Dubai Sports 3 UAE","Dubai Racing 1 UAE","Dubai Racing 2 UAE","DSTV Mzansi Magic",
            "DSTV M-Net","DSTV kykNET & kie","Discovery Life Channel","Disney Channel","Discovery Channel","Discovery Family","Disney XD","Destination America","Disney JR",
            "Dave","ESPN USA","ESPN2 USA","ESPNU USA","ESPN 1 NL","ESPN 2 NL","Eleven Sports 1 Poland","Eleven Sports 2 Poland","Eleven Sports 3 Poland","Eleven Sports 1 Portugal",
            "Eleven Sports 2 Portugal","Eleven Sports 3 Portugal","Eleven Sports 4 Portugal","Eleven Sports 5 Portugal","EuroSport 1 UK","EuroSport 2 UK","EuroSport 1 Poland",
            "EuroSport 2 Poland","EuroSport 1 Spain","EuroSport 2 Spain","EuroSport 1 Italy","EuroSport 2 Italy","Eurosport 1 Bulgaria","Eurosport 2 Bulgaria",
            "ESPN Premium Argentina","ESPN Brasil","ESPN2 Brasil","ESPN3 Brasil","ESPN4 Brasil","ESPN SUR","ESPN2 SUR","ESPN Deportes","ESPNews","E! Entertainment Television",
            "E4 Channel","Fox Sports 1 USA","Fox Sports 2 USA","FOX Soccer Plus","Fox Cricket","FOX Deportes USA","FOX Sports 502 AU","FOX Sports 503 AU","FOX Sports 504 AU",
            "FOX Sports 505 AU","FOX Sports 506 AU","FOX Sports 507 AU","Fox Sports Argentina","Fox Sports 2 Argentina","Fox Sports 3 Argentina","Fox Sports Premium MX",
            "FilmBox Premium Poland","Fight Network","Fox Business","FOX HD Bulgaria","FOX USA","FX USA","FXX USA","Freeform","Fox News","FX Movie Channel","FYI","Film4 UK",
            "Fashion TV","FETV - Family Entertainment Television","FOXNY USA","Fox Weather Channel","GOL PLAY Spain","GOLF Channel USA","Game Show Network","Gol Mundial 1",
            "Gold UK","Galavisión USA","Grit Channel","Globo SP","Globo RIO","Global CA","The Hallmark Channel","Hallmark Movies & Mysterie","HBO USA","HBO2 USA",
            "HBO Comedy USA","HBO Family USA","HBO Latino USA","HBO Signature USA","HBO Zone USA","HBO Poland","History USA","Headline News","HGTV","HOT3 Israel",
            "HR Fernsehen DE","ITV 1 UK","ITV 2 UK","ITV 3 UK","ITV 4 UK","Italia 1 Italy","Investigation Discovery (ID USA)","ION USA","IFC TV USA","Kanal 4 Denmark",
            "Kanal 5 Denmark","Kabel Eins (Kabel 1) DE","LaLiga SmartBank TV","L'Equipe France","La Sexta Spain","Liverpool TV (LFC TV)","Lifetime Network","Lifetime Movies Network",
            "Longhorn Network USA","La7 Italy","LA7d HD+ Italy","Match Football 1 Russia","Match Football 2 Russia","Match Football 3 Russia","Match Premier Russia",
            "Match TV Russia","МАТЧ! БОЕЦ Russia","Movistar Laliga","Movistar Liga de Campeones","Movistar Deportes Spain","Movistar Deportes 2 Spain","Movistar Deportes 3 Spain",
            "Movistar Deportes 4 Spain","Movistar Golf Spain","Motowizja Poland","MSG USA","MSNBC","Magnolia Network","MTV UK","MTV USA","MUTV UK","MAVTV USA",
            "Max Sport 1 Croatia","Max Sport 2 Croatia","Marquee Sports Network","Max Sport 1 Bulgaria","Max Sport 2 Bulgaria","Max Sport 3 Bulgaria","Max Sport 4 Bulgaria",
            "MLB Network USA","MASN USA","MY9TV USA","Motor Trend","METV USA","MDR DE","Mundotoro TV Spain","MTV Denmark","NHL Network USA","Nova Sport Bulgaria",
            "Nova Sport Serbia","Nova Sports 1 Greece","Nova Sports 2 Greece","Nova Sports 3 Greece","Nova Sports 4 Greece","Nova Sports 5 Greece","Nova Sports 6 Greece",
            "Nova Sports Premier League Greece","Nova Sports Start Greece","Nova Sports Prime Greece","Nova Sports News Greece","NESN USA","NBC USA","NBA TV USA",
            "NBC Sports Chicago","NBC Sports Philadelphia","NBC Sports Washington","NFL Network","NBC Sports Bay Area","NBC Sports Boston","NBC Sports California","NBCNY USA",
            "Nova TV Bulgaria","National Geographic (NGC)","NICK JR","NICK","Nick Music","Nicktoons","NDR DE","NewsNation USA","Newsmax USA","Nat Geo Wild USA","Noovo CA",
            "New! CWPIX 11","OnTime Sports","OnTime Sports 2","ONE 1 HD Israel","ONE 2 HD Israel","Orange Sport 1 Romania","Orange Sport 2 Romania","Orange Sport 3 Romania",
            "Orange Sport 4 Romania","Oprah Winfrey Network (OWN)","Oxygen True Crime","Polsat Poland","Polsat Sport Poland","Polsat Sport Extra Poland",
            "Polsat Sport News Poland","Polsat News Poland","Polsat Film Poland","Porto Canal Portugal","ProSieben (PRO7) DE","PTV Sports","Premier Brasil","Prima Sport 1",
            "Prima Sport 2","Prima Sport 3","Prima Sport 4","Paramount Network","POP TV USA","RTE 1","RTE 2","RMC Sport 1 France","RMC Sport 2 France","RTP 1 Portugal",
            "RTP 2 Portugal","RTP 3 Portugal","Rai 1 Italy","Rai 2 Italy","Rai 3 Italy","Rai Sport Italy","Rai Premium Italy","Real Madrid TV Spain","RDS CA","RDS 2 CA",
            "RDS Info CA","Ring Bulgaria","RTL7 Netherland","Racing Tv UK","Reelz Channel","Sky Sports Football UK","Sky Sports Arena UK","Sky Sports Action UK",
            "Sky Sports Main Event","Sky sports Premier League","Sky Sports F1 UK","Sky Sports Cricket","Sky Sports Golf UK","Sky Sports Golf Italy","Sky Sport MotoGP Italy",
            "Sky Sport Tennis Italy","Sky Sport F1 Italy","Sky Sports News UK","Sky Sports MIX UK","Sky Sport Top Event DE","Sky Sport Mix DE","Sky Sport Bundesliga 1 HD",
            "Sky Sport Austria 1 HD","SportsNet New York (SNY)","Sky Sport Football Italy","Sky Sport UNO Italy","Sky Sport Arena Italy","Sky Sports Racing UK","Sky UNO Italy",
            "Sky Sport 1 NZ","Sky Sport 2 NZ","Sky Sport 3 NZ","Sky Sport 4 NZ","Sky Sport 5 NZ","Sky Sport 6 NZ","Sky Sport 7 NZ","Sky Sport 8 NZ","Sky Sport 9 NZ",
            "Sky Sport Select NZ","Sport TV1 Portugal","Sport TV2 Portugal","Sport TV4 Portugal","Sport TV3 Portugal","Sport TV5 Portugal","Sport TV6 Portugal","SIC Portugal",
            "SEC Network USA","SporTV Brasil","SporTV2 Brasil","SporTV3 Brasil","Sport Klub 1 Serbia","Sport Klub 2 Serbia","Sport Klub 3 Serbia","Sport Klub 4 Serbia",
            "Sport Klub HD Serbia","Sportsnet Ontario","Sportsnet One","Sportsnet West","Sportsnet East","Sportsnet 360","Sportsnet World","SuperSport Grandstand",
            "SuperSport PSL","SuperSport Premier league","SuperSport LaLiga","SuperSport Variety 1","SuperSport Variety 2","SuperSport Variety 3","SuperSport Variety 4",
            "SuperSport Action","SuperSport Rugby","SuperSport Golf","SuperSport Tennis","SuperSport Motorsport","Supersport Football","SuperSport Cricket",
            "SuperSport MaXimo 1","Sporting TV Portugal","SportDigital Fussball","Spectrum Sportsnet LA","Sport1+ Germany","Sport1 Germany","S4C UK","SAT.1 DE",
            "Sky Cinema Premiere UK","Sky Cinema Select UK","Sky Cinema Hits UK","Sky Cinema Greats UK","Sky Cinema Animation UK","Sky Cinema Family UK",
            "Sky Cinema Action UK","Sky Cinema Thriller UK","Sky Cinema Sci-Fi Horror UK","Sky Cinema Collection Italy","Sky Cinema Uno Italy","Sky Cinema Action Italy",
            "Sky Cinema Comedy Italy","Sky Cinema Uno +24 Italy","Sky Cinema Romance Italy","Sky Cinema Family Italy","Sky Cinema Due +24 Italy","Sky Cinema Drama Italy",
            "Sky Cinema Suspense Italy","Sky Sport 24 Italy","Sky Sport Calcio Italy","Sky Calcio 1 (251) Italy","Sky Calcio 2 (252) Italy","Sky Calcio 3 (253) Italy",
            "Sky Calcio 4 (254) Italy","Sky Calcio 5 (255) Italy","Sky Calcio 6 (256) Italy","Sky Calcio 7 (257) Italy","Sky Serie Italy","StarzPlay CricLife 1 HD",
            "StarzPlay CricLife 2 HD","StarzPlay CricLife 3 HD","Sky Showcase UK","Sky Arts UK","Sky Comedy UK","Sky Crime","Sky History","SSC Sport 1","SSC Sport 2",
            "SSC Sport 3","SSC Sport 4","SSC Sport 5","SSC Sport Extra 1","SSC Sport Extra 2","SSC Sport Extra 3","Sport 1 Israel","Sport 2 Israel","Sport 3 Israel",
            "Sport 4 Israel","Sport 5 Israel","Sport 5 PLUS Israel","Sport 5 Live Israel","Sport 5 Star Israel","Sport 5 Gold Israel","Science Channel","Showtime USA",
            "Showtime SHOxBET USA","Starz","Sky Witness HD","Sixx DE","Sky Atlantic","SYFY USA","Sundance TV","SWR DE","SUPER RTL DE","SR Fernsehen DE",
            "Smithsonian Channel","TNT Sports 1 UK","TNT Sports 2 UK","TNT Sports 3 UK","TNT Sports 4 UK","TSN1","TSN2","TSN3","TSN4","TSN5","TVN HD Poland",
            "TVN24 Poland","TVP1 Poland","TVP2 Poland","Telecinco Spain","TVE La 1 Spain","TVE La 2 Spain","TVI Portugal","TVI Reality Portugal","Teledeporte Spain (TDP)",
            "TYC Sports Argentina","TVP Sport Poland","TNT Brasil","TNT Sports Argentina","TNT Sports HD Chile","Tennis Channel","Ten Sports PK","TUDN USA","Telemundo",
            "TBS USA","TLC","TNT USA","TVA Sports","TVA Sports 2","Travel Channel","TruTV USA","TVLAND","TCM USA","TMC Channel USA","The Food Network","The Weather Channel",
            "TVP INFO","TeenNick","TV ONE USA","TV2 Bornholm Denmark","TV2 Sport X Denmark","TV3 Sport Denmark","TV2 Sport Denmark","TV2 Denmark","TV2 Zulu","TV3+ Denmark",
            "TVO CA","Tennis+ 1","Tennis+ 2","Tennis+ 3","Tennis+ 4","Tennis+ 5","Tennis+ 6","Tennis+ 7","Tennis+ 8","Tennis+ 9","Tennis+ 10","Tennis+ 11","Tennis+ 12",
            "Tennis+ 13","Tennis+ 14","Tennis+ 15","USA Network","Universal Kids USA","Univision","Unimas","Viaplay Sports 1 UK","Viaplay Sports 2 UK","Viaplay Xtra UK",
            "#Vamos Spain","V Film Premiere","V Film Family","VH1 USA","Veronica NL Netherland","VTV+ Uruguay","VICE TV","Willow Cricket","Willow XTRA","WWE Network",
            "Win Sports+ Columbia","WETV USA","WDR DE","YES Network USA","Yes Movies Action Israel","Yes Movies Kids Israel","Yes Movies Comedy Israel","Yas TV UAE",
            "Yes TV CA","Ziggo Sport Docu NL","Ziggo Sport Select NL","Ziggo Sport Racing NL","Ziggo Sport Voetbal NL","BBC 1 DE","ZDF Info DE","20 Mediaset Italy",
            "6'eren Denmark","#0 Spain","5 USA","3sat DE"
        ];

        function loadDaddyLive() {
            // Generate list based on the array order (Index 0 = Stream 1, Index 1 = Stream 2...)
            allChannels = dlChannelNames.map((name, index) => {
                return {
                    name: name,
                    group: "DADDYLIVE",
                    source: "DLHD",
                    url: `https://dlhd.link/stream/stream-${index + 1}.php`,
                    isIframe: true
                };
            });
            
            // Render and Switch
            renderList(allChannels);
            document.getElementById('loadScreen').style.display = 'none';
            document.getElementById('listView').style.display = 'flex';
        }

        // --- 2. FOX TV LOGIC ---
        function loadFoxTV() {
            document.getElementById('loadScreen').style.display = 'none';
            document.getElementById('listView').style.display = 'none';
            document.getElementById('playerView').style.display = 'flex';
            
            playIframe("https://dlhd.link/stream/stream-54.php", "FOX LIVE");
        }

        // --- 3. STANDARD UI LOGIC ---
        function addInputRow() {
            const container = document.getElementById('inputContainer');
            const div = document.createElement('div');
            div.className = 'input-row';
            div.innerHTML = `
                <input type="text" class="url-input" placeholder="Another Playlist URL...">
                <button class="btn-remove" onclick="removeRow(this)"><i class="fa-solid fa-times"></i></button>
            `;
            container.appendChild(div);
        }
        function removeRow(btn) { btn.parentElement.remove(); }
        function logStatus(msg, type='info') {
            const log = document.getElementById('statusLog');
            const color = type === 'error' ? '#ff4444' : (type === 'success' ? '#00ff00' : '#888');
            log.innerHTML += `<div style="color:${color}; margin-bottom:4px;">> ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // --- 4. PLAYLIST FETCH LOGIC ---
        async function fetchSmart(url) {
            try {
                const response = await fetch(url);
                if (response.ok) return await response.text();
                throw new Error("Direct failed");
            } catch (e) {
                try {
                    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
                    const response = await fetch(proxyUrl);
                    if (response.ok) return await response.text();
                    throw new Error("Proxy failed");
                } catch (e2) {
                    const proxyUrl2 = 'https://corsproxy.io/?' + encodeURIComponent(url);
                    const response = await fetch(proxyUrl2);
                    if (response.ok) return await response.text();
                    throw new Error("All proxies failed");
                }
            }
        }

        async function loadAllPlaylists() {
            const inputs = document.querySelectorAll('.url-input');
            const btn = document.querySelector('.btn-start');
            document.getElementById('statusLog').innerHTML = '';
            
            let urls = [];
            inputs.forEach(input => { if(input.value.trim()) urls.push(input.value.trim()); });
            if(urls.length === 0) return alert("Please add at least one URL.");

            btn.innerText = `Fetching...`;
            btn.disabled = true;
            allChannels = []; 

            for (let i = 0; i < urls.length; i++) {
                let url = urls[i];
                let sourceLabel = 'Source ' + (i+1);
                try { try { sourceLabel = new URL(url).hostname.replace('www.',''); } catch(e){} } catch(e){}

                logStatus(`Fetching: ${sourceLabel}...`);
                try {
                    const content = await fetchSmart(url);
                    const newChannels = parseM3U(content, sourceLabel);
                    if(newChannels.length > 0) {
                        logStatus(`Success: ${newChannels.length} channels`, 'success');
                        allChannels = allChannels.concat(newChannels);
                    } else {
                        logStatus(`No channels found in ${sourceLabel}`, 'error');
                    }
                } catch (e) {
                    logStatus(`Failed: ${sourceLabel}`, 'error');
                }
            }

            if(allChannels.length > 0) {
                renderList(allChannels); 
                document.getElementById('loadScreen').style.display = 'none';
                document.getElementById('listView').style.display = 'flex';
            } else {
                btn.innerText = "LOAD CHANNELS";
                btn.disabled = false;
                alert("Failed to load channels. See status log.");
            }
        }

        function parseM3U(content, sourceLabel) {
            const lines = content.split('\n');
            const channels = [];
            let current = {};
            lines.forEach(line => {
                line = line.trim();
                if(line.startsWith('#EXTINF:')) {
                    const logo = line.match(/tvg-logo="([^"]*)"/);
                    const group = line.match(/group-title="([^"]*)"/);
                    const name = line.substring(line.lastIndexOf(',') + 1).trim();
                    current.logo = logo ? logo[1] : null;
                    current.group = group ? group[1] : 'General';
                    current.name = name || 'Unknown Channel';
                } else if(line.startsWith('http') || line.endsWith('.m3u8') || line.endsWith('.ts')) {
                    current.url = line;
                    current.source = sourceLabel;
                    current.isIframe = false;
                    if(current.name) channels.push(current);
                    current = {};
                }
            });
            return channels;
        }

        // --- 5. RENDER LOGIC ---
        function renderList(channels) {
            const container = document.getElementById('listContent');
            container.innerHTML = ''; 
            
            const subset = channels.slice(0, RENDER_LIMIT);
            const fragment = document.createDocumentFragment();

            subset.forEach(ch => {
                const div = document.createElement('div');
                div.className = 'channel-row';
                const logoHtml = ch.logo ? `<img src="${ch.logo}" onerror="this.parentElement.innerHTML='TV'">` : `<span style="font-weight:bold; color:#555;">${ch.name.substring(0,2)}</span>`;
                
                let badgeClass = 'badge-source';
                if(ch.group === 'DADDYLIVE') badgeClass = 'badge-dl';
                
                let btnClass = 'btn-watch';
                if(ch.group === 'DADDYLIVE') btnClass += ' dl-btn';

                div.innerHTML = `
                    <div class="row-actions"><button class="${btnClass}" onclick="decidePlayer('${ch.url}', ${ch.isIframe})"><i class="fa-solid fa-play"></i> Watch</button></div>
                    <div class="row-logo">${logoHtml}</div>
                    <div class="row-info">
                        <div class="row-title">${ch.name}</div>
                        <div style="margin-top:5px;"><span class="badge ${badgeClass}">${ch.source}</span><span class="badge badge-group">${ch.group}</span></div>
                    </div>
                `;
                fragment.appendChild(div);
            });
            
            container.appendChild(fragment);

            if(channels.length > RENDER_LIMIT) {
                const info = document.createElement('div');
                info.className = 'results-info';
                info.innerText = `Showing top ${RENDER_LIMIT} matches. Type more to refine search.`;
                container.appendChild(info);
            }
        }

        function handleSearch() {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(() => { filterChannels(); }, 300);
        }

        function filterChannels() {
            const term = document.getElementById('channelSearch').value.toLowerCase();
            const filtered = allChannels.filter(ch => 
                ch.name.toLowerCase().includes(term) || 
                ch.group.toLowerCase().includes(term)
            );
            renderList(filtered);
        }

        // --- 6. PLAYER CONTROLLER ---
        function decidePlayer(url, isIframe) {
            document.getElementById('listView').style.display = 'none';
            document.getElementById('playerView').style.display = 'flex';

            if(isIframe) {
                playIframe(url, "LIVE STREAM");
            } else {
                playHLS(url);
            }
        }

        function playIframe(url, label) {
            video.style.display = 'none';
            video.pause();
            iframeContainer.style.display = 'block';
            
            qualitySelect.style.display = 'none';
            resBadge.innerText = label;
            resBadge.style.color = "#ff4757";
            resBadge.style.borderColor = "#ff4757";

            // ALLOWED: Scripts + Same Origin + Presentation (No Sandbox = Unlocked)
            iframeContainer.innerHTML = `
                <iframe 
                    src="${url}" 
                    width="100%" 
                    height="100%" 
                    style="border:0;" 
                    allowfullscreen
                    allow="encrypted-media"
                ></iframe>
            `;
        }

        function playHLS(url) {
            video.style.display = 'block';
            iframeContainer.style.display = 'none';
            iframeContainer.innerHTML = ''; 

            qualitySelect.style.display = 'none'; 
            resBadge.innerText = "Connecting...";
            resBadge.style.color = "#00ff00";
            resBadge.style.borderColor = "#00ff00";

            if(Hls.isSupported()) {
                if(hls) hls.destroy();
                hls = new Hls({maxBufferLength: 60, enableWorker: true});
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, (e, data) => { video.play(); updateQualityOptions(hls.levels); });
                hls.on(Hls.Events.LEVEL_SWITCHED, (e, data) => { 
                    const lvl = hls.levels[data.level];
                    if(lvl) resBadge.innerText = `${lvl.width}x${lvl.height} | LIVE`;
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
                video.play();
                resBadge.innerText = "Native Player";
            }
        }

        function updateQualityOptions(levels) {
            qualitySelect.innerHTML = '<option value="-1">Auto</option>';
            if(levels.length > 1) {
                qualitySelect.style.display = 'block';
                levels.forEach((l, i) => {
                    const opt = document.createElement('option');
                    opt.value = i; opt.text = l.height + 'p';
                    qualitySelect.appendChild(opt);
                });
            }
        }
        function changeQuality(val) { if(hls) hls.currentLevel = parseInt(val); }

        function toggleCustomFullscreen() {
            if (!document.fullscreenElement) {
                playerBody.requestFullscreen();
                playerBody.classList.add('is-fullscreen');
            } else {
                document.exitFullscreen();
                playerBody.classList.remove('is-fullscreen');
            }
        }
        document.addEventListener('fullscreenchange', () => { if (!document.fullscreenElement) playerBody.classList.remove('is-fullscreen'); });

        function goBack() {
            video.pause();
            iframeContainer.innerHTML = ''; 
            if(hls) hls.destroy();
            document.getElementById('playerView').style.display = 'none';
            
            if(iframeContainer.style.display === 'block' && resBadge.innerText === 'FOX LIVE') {
                 document.getElementById('loadScreen').style.display = 'flex';
            } else {
                document.getElementById('listView').style.display = 'flex';
            }
        }
    </script>
</body>
</html>
